input{\n  kafka{\n      id => \"kafka_out_sophos\"\n      client_id => \"out_sophos\"\n      bootstrap_servers => \"localhost:9094\"\n      auto_offset_reset => \"earliest\"\n      partition_assignment_strategy  => \"sticky\"\n      topics => \"in_sophos\"\n      consumer_threads => 2\n      codec => \"json\"\n      add_field => { \"kafka_topic\" => \"in_sophos\" }\n  }\n}\n\nfilter {\n\tif [event][original] and [message] {\n\t\tmutate {\n\t\t\tremove_field => [\"[event][original]\"]\n\t\t}\n\t}\n\t# Do not activate below line\n\t# if [message] { fingerprint { source => [\"message\"] method => \"MD5\" key => \"${HMAC_SALT:APKS!em}\" target => \"event.hash\" } }\n\tmutate {\n\t\tadd_field => {\n\t\t\t\"[data_source][name]\" => \"sophos\"\n\t\t\t\"[enrich_activator]\" => false\n\t\t}\n\t}\n\tif [enrich_activator] {\n\t\tmutate {\n\t\t\tadd_field => {\n\t\t\t\t\"[ioc][ip]\" => false\n\t\t\t\t\"[ioc][url]\" => false\n\t\t\t\t\"[ioc][domain]\" => false\n\t\t\t\t\"[ioc][email]\" => false\n\t\t\t\t\"[ioc][sha256]\" => false\n\t\t\t\t\"[ioc][sha1]\" => false\n\t\t\t\t\"[enrich][network_direction]\" => false\n\t\t\t\t\"[enrich][tld]\" => false\n\t\t\t\t\"[enrich][user_agent]\" => false\n\t\t\t\t\"[enrich][dga]\" => false\n\t\t\t\t\"[enrich][geo]\" => false\n\t\t\t\t\"[enrich][top_1m]\" => false\n\t\t\t\t\"[enrich][naked_ip]\" => false\n\t\t\t\t\"[enrich][url_length]\" => false\n\t\t\t\t\"[enrich][user_agent_length]\" => false\n\t\t\t\t\"[enrich][dns_question_name_length]\" => false\n\t\t\t\t\"[enrich][commiunity_id]\" => false\n\t\t\t\t\"[enrich][uri_part]\" => false\n\t\t\t\t\"[enrich][status_code]\" => false\n\t\t\t}\n\t\t}\n\t}\n\telse {}\n\n\t\tmutate{\n\t\t\tadd_field => {\n\t\t\t\t\"[event][kind]\" => \"event\"\n\t\t\t}\n\t\t\tgsub => [\"message\" , \"= \" , '=\"\" ']\n\t\t}\n\t\tgrok {\n\t\t\tmatch => {\"message\" => \".*?>(?<kv_part>.*$)\"}\n\t\t}\n\t\tkv {\n\t\t\tfield_split_pattern => '\s(?=\w+=)'\n\t\t\tsource => \"kv_part\"\n\t\t\ttarget => \"sophos\"\n\t\t}\n        \n        \n\t\tif [sophos][log_type] == \"Firewall\" {\n\t\t\tmutate {\n\t\t\t\tadd_field => {\n\t\t\t\t\t\"[event][category]\" => \"network\"\n\t\t\t\t\t\"[event][type]\" => \"connection\"\n\t\t\t\t\t\"[event.tag]\" => \"communicate\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if ([sophos][log_type] == \"WAF\" or [sophos][log_type] == \"Content Filtering\") {\n\t\t\tmutate {\n\t\t\t\tadd_field => {\n\t\t\t\t\t\"[event][category]\" => [\"web\",\"network\"]\n\t\t\t\t\t\"[event][type]\" => [\"connection\",\"access\"]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n        else if [sophos][log_type] == \"IDP\" {\n            mutate {\n                add_field => {\n\t\t\t\t\t\"[event][category]\" => [\"intrusion_detection\",\"network\"]\n\t\t\t\t\t\"[event][type]\" => [\"connection\",\"info\"]\n\t\t\t\t\t\"[event.tag]\" => \"attack\"\n\t\t\t\t}\n            }\n        }\n\t\telse if [sophos][log_type] == \"Anti-Spam\" {\n\t\t\tmutate {\n\t\t\t\tadd_field => { \n\t\t\t\t\t\"[event][category]\" => [\"email\",\"network\"]\n\t\t\t\t\t\"[event][type]\" => \"info\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if [sophos][log_type] == \"System Health\" {\n\t\t\tmutate {\n\t\t\t\tadd_field => {\n\t\t\t\t\t\"[event][category]\" => \"host\"\n\t\t\t\t\t\"[event][type]\" => \"info\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if [sophos][log_type] == \"Event\" {\n\t\t\n\t\t\tif [sophos][log_component] == \"GUI\" {\n\t\t\t\tmutate {\n\t\t\t\t\tadd_field => {\n\t\t\t\t\t\t\t\t\t\"[event][category]\" => \"authentication\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif [sophos][src_ip] and [sophos][src_ip] !~ /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/ {\n\t\t\t\t\tsplit {\n\t\t\t\t\t\tfield => \"[sophos][src_ip]\"\n\t\t\t\t\t\ttarget => \"src_ip_check\"\n\t\t\t\t\t\tterminator => \" \"\n\t\t\t\t\t\tremove_field => [\"[sophos][src_ip]\"]\n\t\t\t\t\t\tadd_field => { \"[sophos][src_ip]\" => \"%{[src_ip_check][0]}\" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {}\n\t\t\t\tif [sophos][message] =~ /^.*logged in successfully.*?/ {\n\t\t\t\t\tmutate\t{\n\t\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\"[event][action]\" => \"login\"\n\t\t\t\t\t\t\t\"[event][outcome]\" => \"success\"\n\t\t\t\t\t\t\t\"[event][type]\" => [\"start\",\"user\"]\n\t\t\t\t\t\t}\n\t\t\t\t\t\trename => { \"user_name\" => \"[user][name]\" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if [sophos][message] =~ /^.*logged out.*?/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => {\n\t\t\t\t\t\t\t\"[event][action]\" => \"logout\" \n\t\t\t\t\t\t\t\"[event][outcome]\" => \"success\"\n\t\t\t\t\t\t\t\"[event][type]\" => [\"end\",\"user\"]\n\t\t\t\t\t\t}\n\t\t\t\t\t\trename => { \"user_name\" => \"[user][name]\" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if [sophos][message] =~ /^.*failed.*?/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => {\n\t\t\t\t\t\t\t\"[event][outcome]\" => \"failure\" \n\t\t\t\t\t\t\t\"[event][[type]\" => \"start\"\n\t\t\t\t\t\t}\n\t\t\t\t\t\trename => { \"user_name\" => \"[user][name]\" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if [sophos][message] =~ /^.*update.*?/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tupdate => { \"[event][category]\" => \"configuration\" }\n\t\t\t\t\t\tadd_field => {\n\t\t\t\t\t\t\t\"[event][type]\" => [\"change\",\"info\"]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\t\t\t\n\t\t\t\t}\n\t\t\t\telse if [sophos][message] =~ /^.*added.*?/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tupdate => { \"[event][category]\" => \"configuration\" }\n\t\t\t\t\t\tadd_field => {\n\t\t\t\t\t\t\t\"[event][type]\" => [\"creation\",\"info\"]\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\telse if [sophos][message] =~ /^.*deleted.*?/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tupdate => { \"[event][category]\" => \"configuration\" }\n\t\t\t\t\t\tadd_field => {\n\t\t\t\t\t\t\t\"[event][type]\" => [\"deletion\",\"info\"]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\telse if ( [sophos][message] =~ /^.*Disable.*?/ or [sophos][message] =~ /^.*Enable.*?/ or [sophos][message] =~ /^.*changed.*?/ ) {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tupdate => { \"[event][category]\" => \"configuration\" }\n\t\t\t\t\t\tadd_field => {\n\t\t\t\t\t\t\t\"[event][type]\" => [\"change\",\"info\"]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if [sophos][log_component] == \"Gateway\" {\n\t\t\t\tmutate {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\"[event][category]\" => \"configuration\"\n\t\t\t\t\t\t\"[event][type]\" => [\"info\",\"change\"]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif [sophos][message] =~ /^.*Up$/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \"[event][action]\" => \"up\" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if [sophos][message] =~ /^.*Down$/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \"[event][action]\" => \"down\" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \"[event][action]\" => \"unknown\" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if [sophos][log_component] == \"Firewall Authentication\" {\n\t\t\t\tmutate {\n\t\t\t\t\tremove_field => [ \"log_subtype\" ]\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\t\t\"[event][category]\" => \"authentication\"\n\t\t\t\t\t}\n\t\t\t\t\trename => { \"user_name\" => \"[user][name]\" }\n\t\t\t\t}\n\t\t\t\tif [sophos][message] =~ /^.*failed.*?/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => {\n\t\t\t\t\t\t\t\"[event][outcome]\" => \"failure\"\n\t\t\t\t\t\t\t\"[event][type]\" => \"start\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if [sophos][message] =~ /^.*logged out.*?/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => {\n\t\t\t\t\t\t\t\"[event][action]\" => \"logout\"\n\t\t\t\t\t\t\t\"[event][outcome]\" => \"success\"\n\t\t\t\t\t\t\t\"[event][type]\" => \"end\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if [sophos][message] =~ /^.*logged in.*?/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => {\n\t\t\t\t\t\t\t\"[event][action]\" => \"login\" \n\t\t\t\t\t\t\t\"[event][outcome]\" => \"success\"\n\t\t\t\t\t\t\t\"[event][type]\" => \"start\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \"[event][action]\" => \"unknown\" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if [sophos][log_component] == \"DHCP Server\" {\n\t\t\t\tmutate {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\"[event][category]\" => \"session\"\n\t\t\t\t\t\t\"[event][type]\" => \"info\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if [sophos][log_component] == \"Anti-Virus\" {\n\t\t\t\t\n\t\t\t\tif ( [sophos][message] =~ /^.*upgraded.*?/ or [sophos][message] =~ /^.*update.*?/ ) {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\"[event][category]\" => \"database\"\n\t\t\t\t\t\t\t\"[event][action]\" => \"update\"\n\t\t\t\t\t\t\t\"[event][type]\" => [\"info\",\"change\"]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\"[event][category]\" => \"malware\"\n\t\t\t\t\t\t\t\"[event][type]\" => \"info\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if [sophos][log_component] == \"Up2Date\" {\n\t\t\t\tmutate {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\t\"[event][category]\" => \"configuration\"\n\t\t\t\t\t\t\t\t\"[event][action]\" => \"update\"\n\t\t\t\t\t\t\t\t\"[event][type]\" => [\"info\",\"change\"]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if [sophos][log_component] == \"IPS\" {\n\t\t\t\tmutate {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\t\"[event][category]\" => \"configuration\"\n\t\t\t\t\t\t\t\t\"[event][action]\" => \"update\"\n\t\t\t\t\t\t\t\t\"[event][type]\" => [\"info\",\"change\"]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if [sophos][log_component] == \"Appliance\" {\n\t\t\t\tif [message] =~ /^.*is successful.*?/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\"[event][category]\" => \"authentication\"\n\t\t\t\t\t\t\t\"[event][outcome]\" => \"success\"\n\t\t\t\t\t\t\t\"[event][type]\" => \"start\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if [sophos][message] =~ /^.*unsuccessful.*?/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\"[event][category]\" => \"authentication\"\n\t\t\t\t\t\t\t\"[event][outcome]\" => \"failure\"\n\t\t\t\t\t\t\t\"[event][type]\" => \"start\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\"[event][action]\" => \"unknown\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if [sophos][log_component] == \"SSL VPN Authentication\" {\n\t\t\t\tmutate  {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\"[event][category]\" => \"authentication\"\n                    }\n\t\t\t\t}\n\t\t\t}\n            else if [sophos][log_component] == \"My Account Authentication\" {\n\t\t\t\tmutate  {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\"[event][category]\" => \"authentication\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n            else if [sophos][log_component] == \"GUI\" {\n\t\t\t\tmutate  {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\"[event][category]\" => \"configuration\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n            else if [sophos][log_component] == \"Appliance\" {\n\t\t\t\tmutate  {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\"[event][category]\" => \"configuration\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\telse if [sophos][log_component] == \"Profile\" {\n\t\t\t\t\tmutate  {\n\t\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\"[event][category]\" => \"configuration\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n            else if [sophos][log_component] == \"SMTP\" {\n\t\t\t\tmutate  {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\"[event][category]\" => \"configuration\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n            else if [sophos][log_component] == \"Firewall\" {\n\t\t\t\tmutate  {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\"[event][category]\" => \"configuration\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\telse if [sophos][log_component] == \"ATP\" {\n\t\t\t\t\tmutate  {\n\t\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\"[event][category]\" => \"configuration\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n            else if [sophos][log_component] == \"CLI\" {\n\t\t\t\tmutate  {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\"[event][category]\" => \"configuration\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n            else if [sophos][log_component] == \"SSL VPN\" {\n\t\t\t\tmutate  {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\"[event][category]\" => \"authentication\"\n                    }\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if [sophos][log_component] == \"Interface\" {\n\t\t\t\tmutate\t{\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\"[event][category]\" => \"configuration\"\n\t\t\t\t\t\t\"[event][type]\" => \"info\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\n\t\t\t\tif [sophos][message] =~ /^.*Up$/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \"[event][action]\" => \"up\" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if [sophos][message] =~ /^.*Down$/ {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \"[event][action]\" => \"down\" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmutate {\n\t\t\t\t\t\tadd_field => { \"[event][action]\" => \"unknown\" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmutate {\n\t\t\t\t\tadd_field => { \n\t\t\t\t\t\t\t\t\t\"[event][action]\" => \"unknown\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n        else {\n            mutate {\n                add_field => { \n\t\t\t\t\t\"[event][category]\" => \"generic\" \n\t\t\t\t}\n            }\n        }\n        \n\t\tmutate {\n\t\t\tadd_field => {\n\t\t\t\t\"[event.data_source.name]\" => \"sophos\"\n\t\t\t}\n\t\t\tremove_field => [\"kv_part\"]\n\t\t\t\t\t\n\n            rename => { \n\t\t\t\t\"[sophos][id]\" => \"[rule][id]\"\n\t\t\t\t\"[sophos][src_ip]\" => \"[source][ip]\"\n\t\t\t\t\"[sophos][src_port]\" => \"[source][port]\"\n\t\t\t\t\"[sophos][dst_ip]\" => \"[destination][ip]\"\n\t\t\t\t\"[sophos][dst_port]\" => \"[destination][port]\"\n\t\t\t\t\"[sophos][httpstatus]\" => \"[http][response][status_code]\"\n\t\t\t\t\"[sophos][name]\" => \"[event.message]\"\n\t\t\t\t\"[sophos][server]\" => \"[server][domain]\"\n\t\t\t\t\"[sophos][user_gp]\" => \"[user][group][name]\"\n\t\t\t\t\"[sophos][tcpflags]\" => \"[tcp.flags]\"\n\t\t\t\t\"[sophos][priority]\" => \"[log][level]\"\n\t\t\t\t\"[sophos][sent_pkts]\" => \"[source][packets]\"\n\t\t\t\t\"[sophos][recv_pkts]\" => \"[destination][packets]\"\n                \"[sophos][protocol]\" => \"[network][transport]\"\n                \"[sophos][ws_protocol]\" => \"[http][version]\"\n                \"[sophos][querystring]\" => \"[url][query]\"\n                \"[sophos][fw_rule_id]\" => \"[rule][id]\"\n                \"[sophos][device_name]\" => \"[observer][name]\"\n                \"[sophos][device_id]\" => \"[observer][serial_number]\"\n                \"[sophos][log_id]\" => \"[event][id]\"\n                \"[sophos][sent_bytes]\" => \"[source][bytes]\"\n\t\t\t\t\"[sophos][bytessent]\" => \"[source][bytes]\"\n\t\t\t\t\"[sophos][bytesrcv]\" => \"[destination][bytes]\"\n                \"[sophos][recv_bytes]\" => \"[destination][bytes]\"\n                \"[sophos][responsetime]\" => \"[response][time]\"\n                \"[sophos][host]\" => \"[host][ip]\"\n                \"[sophos][sourceip]\" => \"[source][ip]\"\n                \"[sophos][localip]\" => \"[destination][ip]\"\n                \"[sophos][src_mac]\" => \"[source][mac]\"\n                \"[sophos][dst_mac]\" => \"[destination][mac]\"\n                \"[sophos][source_network_name]\" => \"[network][inner][vlan][name]\"\n                \"[sophos][in_interface]\" => \"[observer][ingress][interface][name]\"\n                \"[sophos][out_interface]\" => \"[observer][egress][interface][name]\"\n                \"[sophos][duration]\" => \"[event][duration]\"\n                \"[sophos][application]\" => \"[network][application]\"\n                \"[sophos][tran_src_ip]\" => \"[source][nat][ip]\"\n                \"[sophos][tran_dst_ip]\" => \"[destination][nat][ip]\"\n                \"[sophos][tran_src_port]\" => \"[source][nat][port]\"\n                \"[sophos][tran_dst_port]\" => \"[destination][nat][port]\"\n                \"[sophos][srczone]\" => \"[observer][ingress][vlan][name]\"\n                \"[sophos][dstzone]\" => \"[observer][egress][vlan][name]\"\n\t\t\t\t\"[message]\" => \"[event][original]\"\n\t\t\t\t\"[sophos][status_code]\" => \"[http][response][status_code]\"\n\t\t\t\t\"[sophos][domain]\" => \"[url][domain]\"\n\t\t\t\t\"[sophos][user]\" => \"[user][name]\"\n\t\t\t\t\"[sophos][useragent]\" => \"[user_agent][original]\"\n\t\t\t\t\"[sophos][user_agent]\" => \"[user_agent][original]\"\n\t\t\t\t\"[sophos][user_name]\" => \"[user][name]\"\n\t\t\t\t\"[sophos][usergroupname]\" => \"[user][group][name]\"\n\t\t\t\t\"[sophos][to_email_address]\" => \"[email][to][address]\"\n\t\t\t\t\"[sophos][from_email_address]\" => \"[email][from][address]\"\n\t\t\t}\n\t\t}\n\n\t\tif [sophos][log_subtype] {\n\t\t\tmutate {\n\t\t\t\tadd_field => {\n\t\t\t\t\t\"[event][action]\" => \"%{[sophos][log_subtype]}\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif [sophos][log_type] == \"WAF\" {\n\t\t\tmutate {\n\t\t\t\trename => { \"[sophos][url]\" => \"[url][original]\" }\n\t\t\t}\n\t\t}\n\t\t\n\t\tif \"Denied\" in [event][action] {\n\t\t\tmutate {\n\t\t\t\tadd_field => { \"[event][type]\" => \"denied\" }\n\t\t\t}\n\t\t}\n\t\telse if \"Allowed\" in [event][action] {\n \t\t\tmutate {\n\t\t\t\tadd_field => { \"[event][type]\" => \"allowed\" }\n\t\t\t} \n        }\n\t\telse{}\n\t\tmutate {\n\t\t\tlowercase => [\"[network][transport]\", \"[log][level]\"]\n\t\t\tadd_tag => [\"preserve_original_event\"]\n\t\t}\n\n}\n\noutput{\n  elasticsearch {\n    hosts => [{% for host in groups['SF'] %}\"https://{{ hostvars[host]['ansible_host'] }}:9200\"{% if not loop.last %},{% endif %}{% endfor %}]\n    api_key => \"{{ logstash_api_key }}\"\n    data_stream => true\n    ssl => true\n    ssl_certificate_verification => false\n  }\n}