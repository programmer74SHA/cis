# Generated: {{ ansible_date_time.iso8601 }}

# Server Configuration
server.host: "0.0.0.0"
server.port: 5601
server.name: "{{ inventory_hostname }}-kibana"
server.publicBaseUrl: "https://{{ hostvars[inventory_hostname].node_hostname }}:5601"

# SSL/TLS Configuration for Kibana Server
{% if kibana_enable_ssl | default(true) %}
server.ssl.enabled: true
server.ssl.key: /usr/share/kibana/config/certs/kibana.key
server.ssl.certificate: /usr/share/kibana/config/certs/kibana.crt
server.ssl.certificateAuthorities: [/usr/share/kibana/config/certs/ca.crt]
{% else %}
server.ssl.enabled: false
{% endif %}

# Elasticsearch Connection
{% set es_node = hostvars[inventory_hostname].elasticsearch_nodes[0] if hostvars[inventory_hostname].elasticsearch_nodes is defined else {} %}
{% set es_port = (es_http_base_port | int) + (es_node.port_offset | int) if es_node else 9200 %}
elasticsearch.hosts: ["https://{{ es_node.name }}.{{ top_level_domain }}:{{ es_port }}"]

# Elasticsearch SSL Configuration
elasticsearch.ssl.certificateAuthorities: [/usr/share/kibana/config/certs/ca.crt]
elasticsearch.ssl.verificationMode: none

{% if es_service_token is defined %}
# Service account token authentication
elasticsearch.serviceAccountToken: {{ es_service_token }}
{% else %}
# Username/password authentication
elasticsearch.username: "{{ kibana_elasticsearch_username }}"
elasticsearch.password: "{{ kibana_elasticsearch_password }}"
{% endif %}

# Logging
logging:
  root:
    level: info
    appenders:
      - kibana-log
  appenders:
    kibana-log:
      type: rolling-file
      fileName: /usr/share/kibana/logs/kibana.log
      policy:
        type: time-interval
        interval: 24h
      layout:
        type: json

# Security
xpack.encryptedSavedObjects.encryptionKey: 7946e75bc0cad7f510d933d288ead678
xpack.reporting.encryptionKey: bd7bc65d6208bb27cb52b035a25d0e72
xpack.security.encryptionKey: 2f80b83bdec5bdab7d5e9c09f67c1141

# Performance
elasticsearch.requestTimeout: 120000

# Telemetry
telemetry.allowChangingOptInStatus: false
telemetry.optIn: false

# Monitoring
monitoring.ui.ccs.enabled: false

# Process ID
pid.file: /usr/share/kibana/data/kibana.pid